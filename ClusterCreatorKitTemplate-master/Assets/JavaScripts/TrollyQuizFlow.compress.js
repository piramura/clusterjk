function e(){if(Object.keys($.state.playerNames||{}).length>=2){if(!$.state.isGameStarted&&!$.state.isGameFinished){$.state.isGameStarted=!0,$.state.isQuestionActive=!0,$.state.questionIndex=0,$.log("Game started! First question is active.");const e=$.worldItemReference("TrollyQuestionUI");e?(e.send("showTrollyQuestionUI",{index:0}),$.log("Showing question 0")):$.log("TrollyQuestionUI not found.")}}else $.log("Cannot start game with fewer than 2 players.")}function t(e){const t=$.worldItemReference("TrollyQuestionUI");t?(t.send("nextTrollyQuestionUI",{index:e}),$.log(`Showing question ${e}`)):$.log("TrollyQuestionUI not found."),function(e){const t=[$.subNode("SM_SimpleSky_Dome_01"),$.subNode("SM_SimpleSky_Dome_02"),$.subNode("SM_SimpleSky_Dome_03")];t.forEach((e=>e.setEnabled(!1)));const s=e%t.length;t[s].setEnabled(!0),$.log(`Door ${s+1} is now open.`)}(e)}function s(e,t){let s=$.state.playerVotes||{};$.state.isGameFinished||s[e]&&s[e].answered?$.log(`Player ${e} has already answered this question or the game is finished.`):(s[e]={choice:t,answered:!0},$.state.playerVotes=s,function(){let e=$.state.playerVotes,t=Object.keys($.state.playerNames||{}).length,s=Object.keys(e||{}).length,n=0,i=0;for(let t in e)"A"===e[t].choice&&n++,"B"===e[t].choice&&i++;if($.log(`Total players: ${t}, Total votes: ${s}`),s>=t){let e=n>i?"A":"B";$.log(`Final team vote is: ${e}`),function(e){let t=$.state.questionIndex,s=o[t].correct_answer;if(e===s){$.state.teamScore++,$.log("Correct answer! Team score increased.");$.audio("Audio1").play()}else{$.log("Incorrect answer.");$.audio("Audio2").play()}$.subNode("TeamScoreDisplay").setText(`TEAM SCORE: ${$.state.teamScore}`),a()}(e)}else $.log("Waiting for more players to vote.")}())}function a(){let e=$.state.questionIndex+1;if($.sendSignalCompat("this","startAnimation"),$.sendSignalCompat("this","startAnimation"),e<o.length){$.state.questionIndex=e,$.state.playerVotes={},t(e);let s=$.state.playerVotes;for(let e in s)s[e].answered=!1;$.state.playerVotes=s}else!function(){const e=$.worldItemReference("TrollyQuestionUI");e&&e.send("finishTrollyQuiz",{totalScore:$.state.teamScore});$.state.isGameFinished=!0,$.log("Game finished. Final team score: "+$.state.teamScore)}()}$.onStart((()=>{$.state.isGameStarted=!1,$.state.isQuestionActive=!1,$.state.isGameFinished=!1,$.state.questionIndex=0,$.state.teamScore=0,$.state.playerVotes={},$.state.playerNames={};$.subNode("TeamScoreDisplay").setText("TEAM SCORE: 0")}));const o=[{question:"大さじ1杯の重さは何グラム？",choices:["A. 10g","B. 15g"],correct_answer:"B"},{question:"日本の消費税率は何％？",choices:["A. 8%","B. 10%"],correct_answer:"B"},{question:"地球上で最も大きい大陸は？",choices:["A. ユーラシア","B. アフリカ"],correct_answer:"A"},{question:"日本の通貨単位は？",choices:["A. 円","B. ドル"],correct_answer:"A"},{question:"赤道上で一周すると何km？",choices:["A. 30,000km","B. 40,000km"],correct_answer:"B"},{question:"氷が溶ける温度は？",choices:["A. 0°C","B. 100°C"],correct_answer:"A"},{question:"音速は約何km/h？",choices:["A. 1,200km/h","B. 340km/h"],correct_answer:"A"},{question:"人間の成人にある骨の数は？",choices:["A. 206本","B. 300本"],correct_answer:"A"},{question:"太陽が地平線に沈むのは東か西か？",choices:["A. 東","B. 西"],correct_answer:"B"},{question:"日本の国鳥は？",choices:["A. ツル","B. キジ"],correct_answer:"B"}];$.onReceive(((t,o,n)=>{switch(t){case"playerJoined":!function(e,t){let s=$.state.playerNames||{};$.state.playerNames[e]?$.log(`Player ${t} is already registered.`):(s[e]=t,$.state.playerNames=s,$.log(`Player ${$.state.playerNames[e]} has joined the game.`)),$.log(`Current players: ${JSON.stringify($.state.playerNames)}`)}(o.playerId,o.userDisplayName);break;case"playerVoted":s(o.playerId,o.choice);break;case"startTrollyGame":e();break;case"nextQuestion":a();break;case"resetGame":!function(){$.state.isGameStarted=!1,$.state.isQuestionActive=!1,$.state.isGameFinished=!1,$.state.questionIndex=0,$.state.teamScore=0,$.state.playerVotes={},$.state.playerNames={},$.subNode("TeamScoreDisplay").setText("TEAM SCORE: 0");const e=$.worldItemReference("TrollyQuestionUI");e&&e.send("resetTrollyQuizUI",{}),$.log("Game has been reset.")}();break;default:$.log(`Unknown message type: ${t}`)}}));