function e(e){if($.state.isGameStarted&&!$.state.isGameFinished&&$.state.isQuestionActive){$.state.isQuestionActive=!1,$.log("Moving to the next question.");const t=$.worldItemReference("QuestionUI");if(t){t.send("nextQuestionUI",{index:e}),$.log(`Sending nextQuestionUI with index ${e}`);let s=$.state.playerData;for(let e in s)s[e].answered=!1;$.state.playerData=s}else $.log("No QuestionUI found.");$.state.isQuestionActive=!0}}function t(t,n){let o=$.state.playerData||{};if($.state.isGameFinished||o[t]&&o[t].answered)return void $.log(`Player ${t} has already answered this question or the game is finished.`);o[t]={choice:n,answered:!0},$.state.playerData=o,$.log(`Updated playerData: ${JSON.stringify(o)}`);let i=$.state.questionIndex;n===a[i].correct_answer?(!function(e,t){let a=$.state.scores||{},n=a[e]||0;n+=t,a[e]=n,$.state.scores=a,s()}(t,1),$.log(`Player ${t} answered correctly.`)):$.log(`Player ${t} answered incorrectly.`),function(){let t=$.state.playerData||{},s=Object.keys($.state.playerNames||{}).length,n=0;for(let e in t)t[e].answered&&n++;if($.log(`Total players: ${s}, Answered players: ${n}`),n===s){$.log("All players have answered.");let t=$.state.questionIndex+1;t<a.length?($.state.questionIndex=t,e(t)):function(){const e=$.worldItemReference("QuestionUI");e&&e.send("finishQuiz",{message:"Game Finished!"});$.state.isGameFinished=!0,$.log("Game finished."),$.log(`Player data at the end of the game: ${JSON.stringify($.state.playerData)}`)}()}}()}function s(){const e=$.subNode("PlayerScoreList");let t="";for(let e in $.state.scores){t+=`Player: ${$.state.playerNames[e]||"Unknown"} - Score: ${$.state.scores[e]}\n`}e.setText(t)}$.onStart((()=>{$.state.isGameStarted=!1,$.state.isQuestionActive=!1,$.state.isGameFinished=!1,$.state.questionIndex=0,$.state.scores=$.state.scores||{},$.state.playerNames=$.state.playerNames||{},$.state.playerData={};$.subNode("PlayerScoreList").setText("PLAYERLIST")}));const a=[{question:"日本の首都はどこですか？",choices:["A. 大阪","B. 東京"],correct_answer:"B"},{question:"富士山の高さはどれくらいですか？",choices:["A. 3,776m","B. 2,500m"],correct_answer:"A"},{question:"日本で最も人口が多い都市は？",choices:["A. 東京","B. 横浜"],correct_answer:"A"},{question:"日本の国花は何ですか？",choices:["A. 桜","B. 菊"],correct_answer:"A"},{question:"日本の通貨単位は何ですか？",choices:["A. 円","B. ドル"],correct_answer:"A"},{question:"北海道の県庁所在地はどこですか？",choices:["A. 札幌","B. 函館"],correct_answer:"A"},{question:"沖縄県の県庁所在地はどこですか？",choices:["A. 那覇","B. 名護"],correct_answer:"A"},{question:"日本の国鳥は何ですか？",choices:["A. キジ","B. ツル"],correct_answer:"A"},{question:"日本の国技は何ですか？",choices:["A. 相撲","B. 剣道"],correct_answer:"A"},{question:"日本で最も高いビルはどれですか？",choices:["A. あべのハルカス","B. 東京スカイツリー"],correct_answer:"A"}];$.onReceive(((a,n,o)=>{switch(a){case"playerJoined":!function(e,t){let a=$.state.playerNames||{},n=$.state.scores||{};void 0===n[e]&&(n[e]=0),a[e]=t,$.state.playerNames=a,$.state.scores=n;const o=$.worldItemReference("JoinUI");o?(o.send("joinPlayer",{playerId:e,userDisplayName:t||"Unknown"}),$.log(`Player ${a[e]} joined.`)):$.log("noy fonnd JoinUI"),s()}(n.playerId,n.userDisplayName);break;case"playerAnswered":t(n.playerId,n.choice);break;case"startGame":!function(){if($.state.isGameStarted||$.state.isGameFinished)$.log("Game is already running or finished.");else{$.state.isGameStarted=!0,$.state.isQuestionActive=!0,$.state.questionIndex=0,$.log("Game started! First question is active.");const e=$.worldItemReference("QuestionUI");e?(e.send("showQuestionUI",0),$.log("Sending showQuestionUI for the first question.")):$.log("QuestionUI not found.")}}();break;case"nextQuestion":e($.state.questionIndex);break;case"resetGame":!function(){$.state.isGameStarted=!1,$.state.isQuestionActive=!1,$.state.isGameFinished=!1,$.state.questionIndex=0,$.state.scores={},$.state.playerNames={},$.state.playerData={},$.subNode("PlayerScoreList").setText("Game has been reset. Ready for a new game.");const e=$.worldItemReference("QuestionUI");e&&e.send("resetQuizUI",{}),$.log("Game has been reset.")}();break;default:$.log(`Unknown message type: ${a}`)}}));